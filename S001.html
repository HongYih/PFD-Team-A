<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link href="./assets/css/login.css" rel="stylesheet">
    <title>MoneyTracker</title>
</head>
<style>
    /*
    .carousel-item{
        height: 32rem;
        background: #777;
        color: #0000;
        position: relative;
    }
    .container {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding-bottom: 50px;
    }
    .overlay-image{
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
    }*/
    .slideShow {
    margin: auto;
    width: 50%;
    }

</style>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #39b54e;">
        <div class = "container-fluid">
            <a class="navbar-brand" href="./index.html" aria-current="page">
                <img src="./images/logo.png" alt="" width="30" height="30" class="d-inline-block align-top">
                GroceryGo
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav mr-auto">
                        <a class="nav-item">
                            <a class="nav-link" href="#">Community Blog</a>
                        </a>
                        <a class="nav-item">
                            <a class="nav-link" href="#">Text Translation</a>
                        </a>
                        <a class="nav-item">
                            <a class="nav-link" href="#">Inventory Details</a>
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                        </ul>
                    </ul>
                        <div class="ml-auto custom-control custom-switch">
                            <input class="custom-control-input" type="checkbox" id="nightModeSwitch">
                            <label class="custom-control-label" style="color: #fff;" for="nightModeSwitch">Night Mode</label>
                        </div>
                </ul>
            </div>
        </div>
    </nav>

    <h1>Supermarket North</h1>

        <div class="container-fluid pt-5">
          <div class="row d-flex justify-content-center ">
            <div class="border border-success col-8 col-md-9title text-center mt-3 bg-ash shadow-lg">
              <h4 class="fs-1">Limited Time Offers</h4>
            </div>
        </div>

        <section>
            <div class="slideShow pb-5" id="slideshow">
                <div class="mySlides">
                <div class="row d-flex justify-content-center">
                    <div class="col col-md-9 shopItem">
                    <div class="card shadow-lg">
                        <img src="https://image.shutterstock.com/image-vector/promotion-square-sticker-sign-banner-260nw-1427755229.jpg" class="card-img-top prodImg" alt="...">
                        <div class="card-body">
                        <h5 class="card-title prodTitle">PROMOTIONS!!</h5>
                        <p class="card-text prodDesc">Keep up with the promotions!!!</p>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </section>

        <div id="shop" class="row bg-carbon" style="height: 200px; overflow: hidden;">
                <div class="col-3 shopLogo" style="padding-top: 2.5%;">
                  <h1>ðŸ’¸ðŸ’»</h1>
                </div>
                <div class="col-5 col-sm-4" style="width: 60%;">
                      <form class="pt-5">
                        <div class="input-group" id="prodSearch">
                            <span class="input-group-text">Search</span>
                            <input type="text" class="form-control userInput">
                        </div>
                        <div class="input-group" id="prodType">
                            <span class="input-group-text">Type</span>
                            <select class="form-select form-select-sm prodTypeSearch" aria-label="form-select">
                                <option value="all">All</option>
                                <option value="shirt">Shirts</option>
                                <option value="electronics">Electronics</option>
                                <option value="food">Food</option>
                                <option value="kitchen">Kitchen</option>
                              </select>
                        </div>
                    </form>
                </div>
            </div>
            <div>
                <div id="shopDisplay" class="row row-cols-1 row-cols-md-3 g-4 bg-dandelion">
                    
                    <div class="col shopItem">
                    <div class="card h-100">
                        <img src="products/shirts/green_tshirt.jpg" class="card-img-top prodImg" alt="img fail to load">
                        <div class="card-body">
                        <h5 class="card-title prodTitle" >Green T-Shirt</h5>
                        <p class="card-text prodDesc" >Very Comfortable T-Shirt</p>
                        <h4>$<span class="prodPrice">12.00</span></h4>
                        <p class="prodType">shirt</p>
                        <button type="button" class="btn btn-secondary addToCart">Add To Cart</button>
                        </div>
                    </div>
                    </div>
                </div>
            
        </div>
    </section>

    <script>
        function carousel() {
            var i;
            var x = document.getElementsByClassName("mySlides");
            for (i = 0; i < x.length; i++) {
                x[i].style.display = "none";
            }
            slideIndex++;
            if (slideIndex > x.length) {slideIndex = 1}
            x[slideIndex-1].style.display = "block";
            setTimeout(carousel, 5000); // Change image every 5 seconds
        }

        var productList = [];

        var slideIndex = 0;
        carousel();
    </script>
    <script type="module">
      // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.1/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyCJibBa9I0XjRSttIhMgh8bym_e6QBhNH0",
            authDomain: "pfddatabase-6127c.firebaseapp.com",
            projectId: "pfddatabase-6127c",
            storageBucket: "pfddatabase-6127c.appspot.com",
            messagingSenderId: "259884057317",
            appId: "1:259884057317:web:964e10e432ecffecd70a0c",
            databaseURL: "https://pfddatabase-6127c-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        import {getDatabase, ref, get, set, child, update, remove}
        from "https://www.gstatic.com/firebasejs/9.4.1/firebase-database.js";

        const db = getDatabase();

        // References
        window.onload = loadAllProducts();
        loadAllPromos();

        function loadAllProducts(){

            const dbref = ref(db);

            get(child(dbref, "Product/")).then(function(AllRecords)
            {
                var body = document.getElementById("shopDisplay");
                    AllRecords.forEach(function(CurrentRecord) {
                        productList.push(CurrentRecord.val());

                    body.innerHTML +=
                    `
                <div class="col shopItem">
                  <div class="card h-100">
                    <img src="${CurrentRecord.val().productImgLink}" class="card-img-top prodImg" alt="img fail to load">
                    <div class="card-body">
                      <h5 class="card-title prodTitle" >${CurrentRecord.val().productName}</h5>
                      <h4>$<span class="prodPrice">${CurrentRecord.val().productPrice}</span></h4>
                      <button type="button" class="btn btn-secondary addToCart">View More Details</button>
                    </div>
                  </div>
                </div>
                    `

                    });
                });
    
    function SelectData(x){

        const dbref = ref(db);

        console.log("hello");
        get(child(dbref, "Product/" + x)).then(snapshot=>{
            if(snapshot.exists()){
                namebox.value = snapshot.val().NameOfStd;
                secbox.value = snapshot.val().Section;
                genbox.value = snapshot.val().Gender;
            }
            else{
                alert("No records found")
            }
        })
        .catch( (error)=>{
            alert("unsuccessfull, error: " + error);
        });
        }
        };
        

        function loadAllPromos()
        {

            const dbref = ref(db);

            get(child(dbref, "Promotions/")).then(function(AllRecords)
            {

                var body = document.getElementById("slideshow");

                AllRecords.forEach(function(CurrentRecord) {
                    console.log(CurrentRecord.val());

                    var Items = [];

                    // Current Record -> Promotins
                    // productList -> list of product 
            
                    for (let j = 0; j < CurrentRecord.val().productID.length; j++)
                    {
                        for (let i = 0; i < productList.length; i++)
                        {
                            if (productList[i].productID == CurrentRecord.val().productID[j])
                            {
                                Items.push(productList[i].productName);
                            }
                        }
                    }

                    var items = Items.toString();

                    body.innerHTML +=
                    `
                    
                    <div class="mySlides">
                        <div class="row d-flex justify-content-center">
                            <div class="col shopItem">
                                <div class="card">
                                    <img src="${CurrentRecord.val().promoImgLink}" class="card-img-top img-fluid prodImg" alt="img fail to load">
                                    <div class="card-body shadow-lg">
                                        <h5 class="card-title prodTitle" >${CurrentRecord.val().promoName}</h5>
                                        <p class="card-text prodDesc" >${CurrentRecord.val().promoDesc}</p>
                                        <h4> <span class="text-danger">Min. Spendature: $ ${CurrentRecord.val().promoMinValue} of wholemeal products!</span> <br> $<span class="text-success prodPrice">${CurrentRecord.val().promoVal * 100}% OFF!!!</span></h4>
                                        <p>Products Available: ${items}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    `
                });
                });
        }
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
</body>
</html>